<script src="../d3/d3.js"></script>

<script>
    window.PlutoniumVisualization = window.PlutoniumVisualization || {};
    /**
     * Behavior for presentation of the data.
     *
     * @polymerBehavior
     */
    PlutoniumVisualization.PresentationBehavior = {
        properties: {
            width: {
                type: Number,
                notify: true
            },
            height: {
                type: Number,
                notify: true
            },
            _width: {
                type: Number
            },
            _height: {
                type: Number
            },
            
            
            _parseDate: {
                type: Object
            },
            
            /**
             * Colors of visualized data.
             *
             * @type {{elements: Array<HTMLElement>, level: number}}
             */
            items: {
                type: Array,
                notify: true,
                value: ["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]
            },
            /**
             * Palette for colors of visualized data.
             *
             * @type {{elements: Array<HTMLElement>, level: number}}
             */
            _palette: {
                type: Object,
                notify: true
            }
        },
        observers: [
            'observeItems(items)',
            'observeLayout(width, height)'
        ],
        created: function () {
            console.log('Initialize ', this, ' presentation.');
        },
        /**
         * Observe `items` object, and synchronize palette for.
         *
         * @param {Array<string>} Color items.
         * 
         */
        observeItems: function (items) {
            console.log(this, ' observe items: ', JSON.stringify(items));
        },
        observeLayout: function (width, height) {
            var margin = {top: 20, right: 20, bottom: 30, left: 50};

            this._width = width - margin.left - margin.right;
            this._height = height - margin.top - margin.bottom;

            this._parseDate = d3.time.format("%d-%b-%y").parse;

            var x = d3.time.scale().range([0, width]);
            var xAxis = d3.svg.axis().scale(x).orient("bottom");
            
            var y = d3.scale.linear().range([height, 0]);
            var yAxis = d3.svg.axis().scale(y).orient("left");

            var area = d3.svg.area()
                    .x(function (d) {
                        return x(d.date);
                    })
                    .y0(height)
                    .y1(function (d) {
                        return y(d.close);
                    });

            var svg = d3.select("body").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            d3.tsv("data.tsv", function (error, data) {
                if (error)
                    throw error;

                data.forEach(function (d) {
                    d.date = parseDate(d.date);
                    d.close = +d.close;
                });

                x.domain(d3.extent(data, function (d) {
                    return d.date;
                }));
                y.domain([0, d3.max(data, function (d) {
                        return d.close;
                    })]);

                svg.append("path")
                        .datum(data)
                        .attr("class", "area")
                        .attr("d", area);

                svg.append("g")
                        .attr("class", "x axis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(xAxis);

                svg.append("g")
                        .attr("class", "y axis")
                        .call(yAxis)
                        .append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 6)
                        .attr("dy", ".71em")
                        .style("text-anchor", "end")
                        .text("Price ($)");
            });

        },
        
        getCoordinate: function(data) {
            
        }

    };
</script>